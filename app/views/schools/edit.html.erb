<section class="content-piece lead-in">
  <div class="gut">
    <h1>Manage <%= @school.name %></h1>
    <h2>You'll want this information to be accurate and up-to-date. Applicants garner interest based off what's represented here.</h2>
  </div>
</section>
<section class="content-piece">
  <div class="gut">
    <% if @error %>
    <div class="form-error">
      <%=raw @error %>
    </div>
    <% end %>
    <div class="form-wrap-set">
      <%= form_for @school, url: { action: "update" } do |school_form| %>

      <div class="form-wrap--big first">
        <fieldset>
          <legend>School Profile</legend>
          <div class="form-field first">
            <%= school_form.label :name, "School Name" %>
            <%= school_form.text_field :name, :readonly => "readonly" %>
          </div>
          <div class="form-field">
            <%= school_form.label :description, "School Description" %>
            <%= school_form.text_area :description, :class => "for-content" %>
          </div>
          <div class="form-field-group--double group">
            <div class="form-field">
              <%= school_form.label :website, "Website" %>
              <%= school_form.url_field :website %>
            </div>
            <div class="form-field">
              <%= school_form.label :email, "Contact Email" %>
              <%= school_form.email_field :email %>
            </div>
          </div>
        </fieldset>
      </div>

      <% @questions.each do |application_set, questions| %>
      <div class="form-wrap--big">
        <fieldset>
          <legend><%= application_set.titlecase %> Application Questions</legend>
          <ul>
            <% questions.each do |question| %>
            <li>
              <input type="checkbox" name="questions[<%= question.id %>]" value="yes" />
              <%= question.label %>
            </li>
            <% end %>
          </ul>
        </fieldset>
      </div>
      <% end %>

      <div class="form-wrap--big">
        <fieldset>
          <legend>Credit Card Information</legend>
          <div class="form-field-group--double group">
            <div class="form-field first">
              <%= label_tag :card_number, "Card Number" %>
              <%= text_field_tag :card_number, nil, :size => 20, 'data-stripe' => 'number' %>
            </div>
            <div class="form-field first">
              <%= label_tag :cvc, "CVC" %>
              <%= text_field_tag :cvc, nil, :size => 4, 'data-stripe' => 'cvc' %>
            </div>
          </div>
          <div class="form-field-group--double group">
            <div class="form-field">
              <%= label_tag :card_exp_month, "Expiration (MM)" %>
              <%= text_field_tag :card_exp_month, nil, :size => 2, 'data-stripe' => 'exp-month' %>
            </div>
            <div class="form-field">
              <%= label_tag :card_exp_year, "Expiration (YYYY)" %>
              <%= text_field_tag :card_exp_year, nil, :size => 4, 'data-stripe' => 'exp-year' %>
            </div>
          </div>
        </fieldset>
      </div>
        
      <div>
        <%= button_tag "Update School", :name => "commit", :type => "submit", :class => "btn--green" %>
      </div>

      <% end %>
    </div>
  </div>
</section>

<% content_for :scripts do %>
  <%= javascript_include_tag "https://js.stripe.com/v2/" %>
  <script>
    Stripe.setPublishableKey("<%= Rails.configuration.stripe_pk %>");
    jQuery(function($) {
      $('#new_school_administrator').submit(function(event) {
        var $form = $(this);
        $form.find('button').prop('disabled', true);
        Stripe.card.createToken($form, function(status, response) {
          if (response.error) {
            $form.find('.payment-errors').text(response.error.message);
            $form.find('button').prop('disabled', false);
          } else {
            var token = response.id;
            $form.append($('<input type="hidden" name="stripe_card_token" />').val(token));
            $form.get(0).submit();
          }
        });
        return false;
      });
    });
  </script>
<% end %>