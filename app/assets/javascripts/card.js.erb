/* Apply to a card */

$.getJSON(cardUpdatePath, function(application) {

  for (var i = 0; i < application['school_selections'].length; i++) {
    $('.btn--apply[data-school="' + application['school_selections'][i].school_id + '"]')
      .text("Added")
      .addClass('applied');
  }

  $(document).on('click', '.btn--apply', function(e) {
    e.stopPropagation();
    e.preventDefault();

    var $this = $(this);
    if ($this.hasClass('applied')) {
      return false;
    }

    var schoolId = $(this).data('school'),
        newSchoolSelection = {
          'priority': application.school_selections.length + 1,
          'school_id': schoolId
        };

    $this.prop('disabled', true);
    application['school_selections'].push(newSchoolSelection);

    $.ajax({
      url: cardUpdatePath,
      type: 'PATCH',
      data: {
        'school_selections': application['school_selections']
      }
    }).done(function(result) {
      $this.text("Added").addClass('applied');
    });

  });

});